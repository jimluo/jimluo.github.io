<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title>ä¸ªäººå­¦ä¹ æ€»ç»“</title>
	<subtitle>è¾“å‡ºæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼</subtitle>
	<link href="https://jimluo.github.io/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://jimluo.github.io/"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2021-12-03T00:00:00+00:00</updated>
	<id>https://jimluo.github.io/atom.xml</id>
	<entry xml:lang="en">
		<title>å¼€å‘minidhcpçš„æ„Ÿå—è®°å½•</title>
		<published>2021-12-03T00:00:00+00:00</published>
		<updated>2021-12-03T00:00:00+00:00</updated>
		<link href="https://jimluo.github.io/minidhcp/" type="text/html"/>
		<id>https://jimluo.github.io/minidhcp/</id>
		<content type="html">&lt;h2 id=&quot;kai-fa-minidhcpde-gan-shou-ji-lu&quot;&gt;å¼€å‘minidhcpçš„æ„Ÿå—è®°å½•&lt;&#x2F;h2&gt;
&lt;p&gt;å¼€å‘æ­¤æœåŠ¡ç›®çš„æ˜¯ä¸ºç½‘ç»œæµé‡åˆ†æå’Œæ§åˆ¶æä¾›ä¸€ç§æ”¯æŒæ‰‹æ®µã€‚å…·ä½“æ–¹æ³•æ˜¯å¢åŠ åŸºäºè§’è‰²åˆ†é…IPæ®µçš„dhcpï¼Œå¹¶è®°å½•åˆ†é…çš„è®¾å¤‡çš„ä¿¡æ¯ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ä¸ºäº†å¿«é€ŸéªŒè¯ï¼Œåœ¨githubä¸Šæ‰¾åˆ°äº†&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;coredhcp&#x2F;coredhcp&quot;&gt;coredhcp&lt;&#x2F;a&gt;ï¼Œå»æ‰äº†dhcp6åŠå…¶ç¹å†—çš„æ’ä»¶ç³»ç»Ÿï¼Œä¼˜åŒ–é‡æ„äº†ç½‘ç»œæ”¶å‘éƒ¨åˆ†ä»£ç ï¼Œé‡å†™äº†optionçš„åˆ†é…ï¼ŒåŠ å…¥äº†åŸºäºè§’è‰²åˆ†é…IPçš„åŠŸèƒ½ï¼Œè§’è‰²ç­–ç•¥é€šè¿‡é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;dhcpxie-yi-liu-cheng&quot;&gt;dhcpåè®®æµç¨‹&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;minidhcp.png&quot; alt=&quot;dhcpåè®®æµç¨‹&quot; &#x2F;&gt;&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;dhcp-lease-sheng-ming-zhou-qi&quot;&gt;DHCP lease ç”Ÿå‘½å‘¨æœŸ&lt;&#x2F;h3&gt;
&lt;p&gt;æµç¨‹ç±»ä¼¼æ‰“å·¥äººç§Ÿæˆ¿ï¼Œå…ˆç”µçº¿æ†å­å¹¿æ’­éœ€æ±‚ï¼Œæ”¶åˆ°æˆ¿æºç”µè¯åç­¾åˆçº¦ï¼Œä½åˆ°æœŸåå†ç»­ç§Ÿã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨DHCPåè®®é‡Œæè¿°çš„æ›´ä¸¥è°¨ï¼Œç”¨ç¼–ç¨‹è¯­è¨€æè¿°å°±æ˜¯ä¼šæœ‰å¤šä¸ªif elseã€‚&lt;&#x2F;p&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºç½‘ç»œé‡Œä¼šæ˜¯ä¸€æ¥ä¸€å›çš„æ¶ˆæ¯è¯·æ±‚å’Œç¡®è®¤ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç±»ä¼¼ç›²äººæ‘¸è±¡ï¼Œä¸åŒçš„è§†è§’è¯´çš„éƒ½ä¸å…¨é¢ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;ç”¨è¯­è¨€æè¿°å¦‚ä¸‹ï¼š&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;æ­¤å‰æ²¡æœ‰è¿‡IPçš„å®¢æˆ·ç«¯å…¨ç½‘å¹¿æ’­å‘DHCPæœåŠ¡ç”³è¯·ï¼Œé€šè¿‡ååˆ†é…ä¸€ä¸ªIPæ—¶é—´é™åˆ¶çš„ç§Ÿçº¦&lt;&#x2F;li&gt;
&lt;li&gt;å·²æœ‰è¿‡IPçš„å®¢æˆ·ç«¯å‘æˆäºˆå®ƒç§Ÿçº¦çš„DHCPæœåŠ¡å™¨è”ç³»ï¼Œä»¥ç¡®è®¤ä¸ºå…¶é‡æ–°åˆ†é…ç§Ÿçº¦&lt;&#x2F;li&gt;
&lt;li&gt;ç§Ÿçº¦è¿‡æœŸåï¼Œå®¢æˆ·ç«¯å°†è”ç³»æœ€åˆæˆäºˆç§Ÿçº¦çš„æœåŠ¡å™¨ç»­ç§Ÿ&lt;&#x2F;li&gt;
&lt;li&gt;å¦‚æœç»­ç§Ÿå¤±è´¥ï¼Œå®¢æˆ·ç«¯å°†å°è¯•é‡æ–°ç»‘å®šåˆ°ä»»ä½•æ´»è·ƒçš„DHCPæœåŠ¡å™¨&lt;&#x2F;li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¸»åŠ¨æ”¾å¼ƒç§Ÿçº¦ä¸‹çº¿(goodbye curel worldğŸ˜¢)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ä»¥ä¸Š5æ­¥åœ¨DHCPæœåŠ¡è®¤çŸ¥çš„ä¸–ç•Œé‡Œï¼Œç”¨Allocationã€Reallocationã€Renewalã€Rebindingå’ŒReleaseæ¥æè¿°ã€‚&lt;&#x2F;p&gt;
&lt;p&gt;å½“ç„¶åœ¨ç§Ÿæˆ¿å®¢çš„è®¤çŸ¥ä¸–ç•Œé‡Œï¼Œæ†§æ†¬æœªæ¥å’Œè´Ÿé‡å‰è¡Œä¹Ÿä¸æˆ¿ä¸œçš„5æ­¥ç›¸å¯¹åº”ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;xian-shuo-xie-yi-de-allocation-da-jia-gong-tong-zun-shou-tong-yang-de-yue-ding&quot;&gt;å…ˆè¯´åè®®çš„Allocationï¼Œå¤§å®¶å…±åŒéµå®ˆåŒæ ·çš„çº¦å®š&lt;&#x2F;h3&gt;
&lt;ol&gt;
&lt;li&gt;client --DISCOVER(myMac, myID)--&amp;gt; servers&lt;&#x2F;li&gt;
&lt;li&gt;client &amp;lt;--OFFER(yourIP, your[DNS,Router,Mask,...], yourID)-- servers&lt;&#x2F;li&gt;
&lt;li&gt;client &amp;lt;--IP[x]-- [1, n]IP from OFFER list &lt;&#x2F;li&gt;
&lt;li&gt;client --REQUEST(IP[x])--&amp;gt; servers&lt;&#x2F;li&gt;
&lt;li&gt;client &amp;lt;--ACK&#x2F;MAK-- server&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;ç”¨è¯­è¨€æè¿°ä¸º&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;å¹¿æ’­æ‰¾æˆ¿&lt;&#x2F;li&gt;
&lt;li&gt;å¹¿å—é’çï¼Œå‘æ¥æˆ¿æºä¿¡æ¯&lt;&#x2F;li&gt;
&lt;li&gt;æŒ‘é€‰1ä¸ªé«˜æ€§ä»·æ¯”çš„æˆ¿&lt;&#x2F;li&gt;
&lt;li&gt;å¹¿æ’­å‘ŠçŸ¥è‡ªå·±å·²æ˜¯æœ‰æˆ¿ä¹‹äºº&lt;&#x2F;li&gt;
&lt;li&gt;æˆ¿ä¸œé€æ¥ç§Ÿæˆ¿åˆåŒç­‰ä½ ç­¾å­—&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;è‰²ä¸å¼‚ç©ºï¼Œç©ºä¸å¼‚è‰²ï¼ŒReallocationã€Renewalã€Rebindingäº¦å¤å¦‚æ˜¯&lt;&#x2F;p&gt;
&lt;h2 id=&quot;serverwang-luo-shou-fa-xi-jie&quot;&gt;serverç½‘ç»œæ”¶å‘ç»†èŠ‚&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯ç›‘å¬åœ¨67ç«¯å£ä¸Šï¼Œæ”¶åˆ°clientè¯·æ±‚åè§£ææœ‰icmpçš„ä¿¡æ¯ï¼Œå“åº”ç»™clientå®¹é”™æ—¶è¦å¤„ç†ä¸‹ï¼Œé‡Œé¢æœ‰ç½‘å¡æ¥å£å¯ä»¥ä½¿ç”¨&lt;&#x2F;li&gt;
&lt;li&gt;å¯¹æ™®é€šè¯·æ±‚ï¼Œå“åº”åŸè·¯2å±‚ethernetè¿”å›ã€‚å…¶ä»–éæ­£å¸¸æ¶ˆæ¯åœ¨3å±‚ipä¸Šicmpè¿”å›é”™è¯¯æé†’&lt;&#x2F;li&gt;
&lt;li&gt;å…·ä½“çš„å‘é€ä½¿ç”¨libpacpï¼Œå‘é€å‰è¦å»æ‰è‡ªå®šä¹‰é“¾è·¯å±‚çš„åè®®å¤´éƒ¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;optionschong-xi-jie&quot;&gt;optionsç§ç»†èŠ‚&lt;&#x2F;h2&gt;
&lt;p&gt;DHCPé€šè¿‡è‡ªå®šä¹‰å¢åŠ å¤šç§ä¸åŒçš„å¯é€‰é¡¹æ¥æ‰©å±•ï¼ŒæœåŠ¡ç«¯è¿”ç»™å®¢æˆ·ç«¯çš„optioné‡Œæœ‰[ip, dns, mask, router, serverID...]å¯è‡ªç”±æ·»åŠ ã€‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†é…æ—¶å…ˆæ ¹æ®å®¢æˆ·ç«¯çš„macæ¥è¯†åˆ«å…¶è§’è‰²ï¼Œå†æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„rangeæ¥åˆ†é…å…·ä½“çš„ipç­‰ä¿¡æ¯&lt;&#x2F;li&gt;
&lt;li&gt;å…¶ä»–æ‰©å±•åœ¨optionsçš„HandlerXXX dispatchå»å³å¯&lt;&#x2F;li&gt;
&lt;li&gt;éœ€è¦å®¢æˆ·ç«¯ä¿¡æ¯çš„ï¼Œå†optionsé‡Œå¯ä»¥å¯¹å…¶æå‡ºï¼Œæ¯”å¦‚Vendorä¿¡æ¯ç­‰&lt;&#x2F;li&gt;
&lt;li&gt;ç»­ç§Ÿç­‰ä¿¡æ¯åœ¨lease.txtå¯æŸ¥å¯ç”¨&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†é…ç®—æ³•ç”¨çš„coredhcpçš„bitmapæ–¹å¼é™ä½å†…å­˜å ç”¨&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;1&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;1&lt;&#x2F;sup&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jimluo&#x2F;minidhcp&quot;&gt;æºç åœ°å€&lt;&#x2F;a&gt;
&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;: &lt;a href=&quot;https:&#x2F;&#x2F;support.huawei.com&#x2F;enterprise&#x2F;zh&#x2F;doc&#x2F;EDOC1100156651&#x2F;bb57bdaa&#x2F;how-dhcp-works&quot;&gt;å›¾ç‰‡æ¥æº&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>BPFæŠ€æœ¯ä»‹ç» - ç”Ÿæ€å’Œå†å²</title>
		<published>2021-11-17T00:00:00+00:00</published>
		<updated>2021-11-17T00:00:00+00:00</updated>
		<link href="https://jimluo.github.io/bpf-vs-dpdk/" type="text/html"/>
		<id>https://jimluo.github.io/bpf-vs-dpdk/</id>
		<content type="html">&lt;h2 id=&quot;bpfji-zhu-jie-shao-sheng-tai-he-li-shi&quot;&gt;BPFæŠ€æœ¯ä»‹ç» - ç”Ÿæ€å’Œå†å²&lt;&#x2F;h2&gt;
&lt;p&gt;æœ¬æ–‡å›¾ç‰‡éƒ½æºäºç½‘ä¸Šå…¬å¼€èµ„æ–™ï¼Œæœªæ³¨æ˜æ¥æºã€‚å†…å®¹æºäºå¯¹ç½‘ç»œæ£€æµ‹ä¸å“åº”NDRçš„å¼€å‘ã€‚&lt;&#x2F;p&gt;
&lt;h3 id=&quot;li-shi-cheng-yin&quot;&gt;å†å²æˆå› &lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;01history.png&quot; alt=&quot;å†å²æˆå› &quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾1ï¼šLinuxå†…æ ¸çš„ä»£ç é‡å¢é•¿&lt;&#x2F;p&gt;
&lt;h3 id=&quot;dpdk-pf-ringhe-bpfde-gong-tong-dian&quot;&gt;DPDKã€PF_RINGå’ŒBPFçš„å…±åŒç‚¹&lt;&#x2F;h3&gt;
&lt;p&gt;åˆ†ç¦»å‡ºç½‘ç»œçš„æ•°æ®å¹³é¢&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œåŠŸèƒ½æ‰©å±•çš„ä»£ä»·æ˜¯ç‰ºç‰²æ€§èƒ½&lt;&#x2F;li&gt;
&lt;li&gt;éƒ½åœ¨çªç ´å†…æ ¸å¤æ‚åº¦çš„é™åˆ¶ -kernel bypass&lt;&#x2F;li&gt;
&lt;li&gt;ä»å†…æ ¸ä¸­åˆ†ç¦»å‡ºæ•°æ®å¹³é¢&lt;&#x2F;li&gt;
&lt;li&gt;å‘ä¸Šäº¤ç»™ç”¨æˆ·æ€å¼€å‘ -DPDKã€PF_RINGå’ŒBPF&lt;&#x2F;li&gt;
&lt;li&gt;å‘ä¸‹å¸è½½åˆ°ç½‘å¡æ‰§è¡Œ -BPFçš„XDP&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;dpdk-pf-ringhe-bpfde-chai-yi-dian-sheng-tai-mu-biao-bu-tong&quot;&gt;DPDKã€PF_RINGå’ŒBPFçš„å·®å¼‚ç‚¹ï¼šç”Ÿæ€ç›®æ ‡ä¸åŒ&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;02canon.png&quot; alt=&quot;DPDK&quot; &#x2F;&gt; DPDK&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;DPDK ç‹¬ç«‹çš„å¹³å°
&lt;ul&gt;
&lt;li&gt;ç‹¬å å†…æ ¸ç½‘ç»œæ ˆ&lt;&#x2F;li&gt;
&lt;li&gt;ä¸“ç”¨çš„SDK API&lt;&#x2F;li&gt;
&lt;li&gt;ç”Ÿæ€é¢å‘ç¡¬ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;åº”ç”¨éš”ç¦»å’Œå®‰å…¨æœºåˆ¶å¤±æ•ˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;PF_RING ç‹¬ç«‹çš„å‚å•†
&lt;ul&gt;
&lt;li&gt;ç‹¬ç«‹çš„æ„å¤§åˆ©å…¬å¸&lt;&#x2F;li&gt;
&lt;li&gt;é«˜æ€§èƒ½ç‰ˆç‹¬ç«‹æ”¶è´¹&lt;&#x2F;li&gt;
&lt;li&gt;ç‹¬ç«‹çš„ç”Ÿæ€&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;03swiss.png&quot; alt=&quot;BPF&quot; &#x2F;&gt; BPF&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;BPF èåˆçš„ç”Ÿæ€
&lt;ul&gt;
&lt;li&gt;å«æ¥åœ¨å†…æ ¸ä¸­&lt;&#x2F;li&gt;
&lt;li&gt;èåˆåœ¨å·²æœ‰çš„è½¯ç¡¬ä»¶ä¸­&lt;&#x2F;li&gt;
&lt;li&gt;ç”Ÿæ€é¢å‘è½¯ä»¶å¹¶å‘å±•è¿…é€Ÿ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;dpdkyu-bpfji-jin-hui&quot;&gt;DPDKä¸BPFåŸºé‡‘ä¼š&lt;&#x2F;h3&gt;
&lt;p&gt;é¢å‘åŸºç¡€è®¾æ–½ï¼šåº•å±‚ç¡¬ä»¶ &#x2F; ä¸Šå±‚ä¸šåŠ¡&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;04foundation.png&quot; alt=&quot;åŸºé‡‘ä¼š&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾2ï¼šä¸¤ç§ä¸åŒåˆ©ç›Šçš„åŸºé‡‘ä¼š&lt;&#x2F;p&gt;
&lt;h3 id=&quot;dpdknian-du-shi-jian-he-ji-zhu-biao-zhun&quot;&gt;DPDKå¹´åº¦äº‹ä»¶å’ŒæŠ€æœ¯æ ‡å‡†&lt;&#x2F;h3&gt;
&lt;p&gt;å¹´åº¦äº‹ä»¶&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;2010ï¼ŒIntelï¼ŒXeon 1ä»£çš„DPDK&lt;&#x2F;li&gt;
&lt;li&gt;2013ï¼Œ6WINDï¼ŒDPDK.orgç¤¾åŒº&lt;&#x2F;li&gt;
&lt;li&gt;2014ï¼ŒOvSï¼ŒOvS-DPDKåˆ†å¸ƒå¼è™šæ‹Ÿäº¤æ¢æœº&lt;&#x2F;li&gt;
&lt;li&gt;2015ï¼ŒARMç‰ˆæœ¬&lt;&#x2F;li&gt;
&lt;li&gt;2017ï¼ŒåŠ å…¥ Linux åŸºé‡‘ä¼š&lt;&#x2F;li&gt;
&lt;li&gt;2018ï¼ŒVMwareï¼Œæ•°æ®ä¸­å¿ƒå†…è½¯ä»¶å®šä¹‰åŸºç¡€ç»“æ„&lt;&#x2F;li&gt;
&lt;li&gt;2019ï¼Œé‡‘èåº”ç”¨(é«˜é¢‘äº¤æ˜“)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æŠ€æœ¯æ ‡å‡†&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;PCI passthroughï¼Œç»•è¿‡Hyper-Væ¨¡æ‹Ÿï¼Œè™šæ‹Ÿæœºç›´é€šPCI&lt;&#x2F;li&gt;
&lt;li&gt;SR-IOVï¼Œç»•è¿‡ Hyper-Vå †æ ˆï¼Œå•ç½‘å¡è™šæ‹Ÿæˆå¤šå¼ ç›´é€šç½‘å¡&lt;&#x2F;li&gt;
&lt;li&gt;FD.io&#x2F;VPPï¼ŒçŸ¢é‡åŠ é€Ÿæ•°æ®IOï¼Œå‡å°‘I-cacheæŠ–åŠ¨å’Œè¯»å»¶æ—¶&lt;&#x2F;li&gt;
&lt;li&gt;vDPAï¼Œ virtio æ•°æ®è·¯å¾„åŠ é€Ÿï¼Œæ§åˆ¶é¢è½¯ä»¶æ¨¡æ‹Ÿï¼Œæ•°æ®é¢ç¡¬ä»¶å®ç°&lt;&#x2F;li&gt;
&lt;li&gt;Switchdevï¼Œå¸è½½å†…æ ¸çš„äº¤æ¢åŠŸèƒ½åˆ°ç¡¬ä»¶&lt;&#x2F;li&gt;
&lt;li&gt;ä»£ç è´¡çŒ®å æ¯” (V21.11)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;bpfxun-su-fa-zhan-de-sheng-tai&quot;&gt;BPFè¿…é€Ÿå‘å±•çš„ç”Ÿæ€&lt;&#x2F;h2&gt;
&lt;p&gt;å¹´åº¦æŠ€æœ¯&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;1992 è®ºæ–‡ï¼ŒBSD Packet Filter&lt;&#x2F;li&gt;
&lt;li&gt;1994 cBPFï¼Œtcpdumpä¸­libpcapçš„å®ç°&lt;&#x2F;li&gt;
&lt;li&gt;2014 eBPFï¼Œé€šç”¨è™šæ‹Ÿæœº&lt;&#x2F;li&gt;
&lt;li&gt;2015 BCCï¼Œå¼€å‘å·¥å…·å’Œåº“&lt;&#x2F;li&gt;
&lt;li&gt;2016 XDPï¼Œç½‘ç»œå†…æ ¸æ—è·¯æ¨¡å—&lt;&#x2F;li&gt;
&lt;li&gt;2017 libbpfï¼Œè„±ç¦»å†…æ ¸ç‹¬ç«‹å‘å±•&lt;&#x2F;li&gt;
&lt;li&gt;2017 ARM&#x2F;MIPSï¼Œå¤šå¹³å°BPF&lt;&#x2F;li&gt;
&lt;li&gt;2018 BTFï¼Œè·¨å†…æ ¸ç‰ˆæœ¬ç±»å‹æ ¼å¼&lt;&#x2F;li&gt;
&lt;li&gt;2019 å°¾è°ƒç”¨å’Œçƒ­æ›´æ–°&lt;&#x2F;li&gt;
&lt;li&gt;2020 LSMå’ŒTCPæ‹¥å¡æ§åˆ¶&lt;&#x2F;li&gt;
&lt;li&gt;2021 eBPFåŸºé‡‘ä¼š&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;äº§å“ç”Ÿæ€&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;2017 Facebookï¼Œç”Ÿäº§ç¯å¢ƒä¸­çš„è´Ÿè½½å‡è¡¡Katran&lt;&#x2F;li&gt;
&lt;li&gt;2018 Cloudflareï¼Œç”Ÿäº§ç¯å¢ƒä¸­çš„DDoS&#x2F;é˜²ç«å¢™ç­‰&lt;&#x2F;li&gt;
&lt;li&gt;2018 Android 9ï¼Œæµé‡ç›‘æ§ï¼ŒåŒ…æ‹¬DHCPClient&lt;&#x2F;li&gt;
&lt;li&gt;2018 Netronomeï¼ŒAgilioæ™ºèƒ½ç½‘å¡æ”¯æŒXDP&lt;&#x2F;li&gt;
&lt;li&gt;2018 DPDKï¼Œæ”¯æŒBPF(ä¸åŒ…æ‹¬MAPå’Œå°¾è°ƒç”¨)&lt;&#x2F;li&gt;
&lt;li&gt;2019 Googleï¼ŒKRSI å†…æ ¸è¿è¡Œæ—¶å®‰å…¨åŠ©æ‰‹(Kernel V5.7)&lt;&#x2F;li&gt;
&lt;li&gt;2019 Sysdigï¼ŒFalcoæèµ ä¸ºk8så®‰å…¨åŸºç¡€&lt;&#x2F;li&gt;
&lt;li&gt;2020 Nvidiaï¼ŒMellanoxæ™ºèƒ½ç½‘å¡æ”¯æŒXDP(ï¿¥3åƒ~9åƒ)&lt;&#x2F;li&gt;
&lt;li&gt;2020 å¾®è½¯ï¼ŒLinuxç‰ˆSysmonï¼ŒeBPF for Windows&lt;&#x2F;li&gt;
&lt;li&gt;2020 å­—èŠ‚ï¼Œé«˜æ€§èƒ½ç½‘ç»œ ACL&lt;&#x2F;li&gt;
&lt;li&gt;2020 é˜¿é‡Œäº‘ï¼ŒåŸºäºCiliumåŠ é€Ÿå’Œæ‰©å±•&lt;&#x2F;li&gt;
&lt;li&gt;2021 Ciliumï¼ŒService mesh (æ— Sidecar)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;dpdkyu-bpfsheng-tai&quot;&gt;DPDKä¸BPFç”Ÿæ€&lt;&#x2F;h3&gt;
&lt;p&gt;é¢å‘ç”Ÿæ€å’Œå¼€å‘è€…ä¸åŒ&lt;&#x2F;p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;äº§å“åˆ†ç±»&lt;&#x2F;th&gt;&lt;th&gt;DPDK&lt;&#x2F;th&gt;&lt;th&gt;BPF&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&lt;&#x2F;thead&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td&gt;å®‰å…¨&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;Falco&#x2F;Cilium&#x2F;L4drop&#x2F;...&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¯è§‚æµ‹æ€§&lt;&#x2F;td&gt;&lt;td&gt;&lt;&#x2F;td&gt;&lt;td&gt;Hubble&#x2F;L3AF&#x2F;Tracee&#x2F;...&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;ç½‘ç»œ&lt;&#x2F;td&gt;&lt;td&gt;DPVS&#x2F;OVS&#x2F;FD.IO&#x2F;VPP&lt;&#x2F;td&gt;&lt;td&gt;Katran&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;SDKs&lt;&#x2F;td&gt;&lt;td&gt;C++&#x2F;GO&lt;&#x2F;td&gt;&lt;td&gt;C++&#x2F;Rust&#x2F;GO&#x2F;Python&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å†…æ ¸&lt;&#x2F;td&gt;&lt;td&gt;TCPæ ˆ F-Stack&#x2F;mTCP&lt;&#x2F;td&gt;&lt;td&gt;helper-API&#x2F;Maps&#x2F;Verfier&amp;amp;JIT&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;tr&gt;&lt;td&gt;å¸‚åœºç”Ÿæ€&lt;&#x2F;td&gt;&lt;td&gt;å…³æ³¨ç¡¬ä»¶èƒ½åŠ›çš„è™šæ‹ŸåŒ–å’Œå…±äº«ï¼Œç¡¬ä»¶å‚å•†æ¨åŠ¨ï¼Œæ˜¯è™šæ‹ŸåŒ–æŠ€æœ¯vt-x&#x2F;eptç­‰åœ¨ç½‘ç»œIOä¸Šçš„æ¼”è¿›&lt;&#x2F;td&gt;&lt;td&gt;å…³æ³¨å†…æ ¸èƒ½åŠ›çš„åˆ†ç¦»å’Œå¤ç”¨äº‘å‚å•†æ¨åŠ¨ï¼Œæ˜¯äº‘åŸç”ŸæŠ€æœ¯æ¼”è¿›å¯¹æœ¬åœ°ç”Ÿæ€çš„èåˆ&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;
&lt;&#x2F;tbody&gt;&lt;&#x2F;table&gt;
&lt;p&gt;è¡¨1ï¼šä¸¤ç§ä¸åŒåˆ©ç›Šçš„åŸºé‡‘ä¼š&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bpfji-zhu-jie-shao-xing-neng-fen-xi&quot;&gt;BPFæŠ€æœ¯ä»‹ç» æ€§èƒ½åˆ†æ&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;dpdkyu-pf-ringji-zhu-yi-tong-ji-zhu-xiang-jin&quot;&gt;DPDKä¸PF_RINGæŠ€æœ¯å¼‚åŒ  - æŠ€æœ¯ç›¸è¿‘&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;05pf_ring.png&quot; alt=&quot;PF_RING&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾3ï¼šPF_RINGåŸç†&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;06dpdk.png&quot; alt=&quot;DPDK&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾4ï¼šDPDKæ¨¡å—ç»“æ„&lt;&#x2F;p&gt;
&lt;p&gt;ç›¸åŒ&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;UIO+PMDä¸»åŠ¨è½®è¯¢ å‡å°‘ä¸­æ–­å’ŒCPUä¸Šä¸‹æ–‡åˆ‡æ¢&lt;&#x2F;li&gt;
&lt;li&gt;UIO+mmap å®ç°é›¶æ‹·è´&lt;&#x2F;li&gt;
&lt;li&gt;HugePages å‡å°‘TLB å¤±æ•ˆ&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;å·®å¼‚&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;PF_RING åˆ†æ™®é€šç‰ˆå’ŒZC(zero copy)é«˜æ€§èƒ½ç‰ˆæœ¬&lt;&#x2F;li&gt;
&lt;li&gt;ZCè®¸å¯è¯æ”¶è´¹ï¼ŒDPDK å…è´¹&lt;&#x2F;li&gt;
&lt;li&gt;ZCä¸DPDKçš„æ€§èƒ½åŸºæœ¬æŒå¹³&lt;&#x2F;li&gt;
&lt;li&gt;ZCåº”ç”¨å±‚APIæ˜“äºä½¿ç”¨ï¼Œå¼€å‘éš¾åº¦è¿œå°äºDPDK&lt;&#x2F;li&gt;
&lt;li&gt;ZCæ˜¯æ„å¤§åˆ©ntopå…¬å¸ä¸‹çš„ä¸€æ¬¾äº§å“ï¼Œç”Ÿæ€å°&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;bpfde-wang-luo-ji-zhu-te-dian&quot;&gt;BPFçš„ç½‘ç»œæŠ€æœ¯ç‰¹ç‚¹&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;08BPF-hook.png&quot; alt=&quot;BPFæ¨¡å—ç»“æ„&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾5ï¼šBPFæ¨¡å—ç»“æ„&lt;&#x2F;p&gt;
&lt;p&gt;BPFçš„7ç§æŒ‚è½½ç‚¹ï¼Œè¦†ç›–å…¨ç”Ÿå‘½å‘¨æœŸæµç¨‹&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;uprobe&lt;&#x2F;li&gt;
&lt;li&gt;syscall&lt;&#x2F;li&gt;
&lt;li&gt;sockmap&#x2F;sockops&lt;&#x2F;li&gt;
&lt;li&gt;kprobe&lt;&#x2F;li&gt;
&lt;li&gt;cgroups&lt;&#x2F;li&gt;
&lt;li&gt;tc&lt;&#x2F;li&gt;
&lt;li&gt;xdp&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;07xdp-pkt.png&quot; alt=&quot;XDPç¨‹åºçš„4ç§åŒ…å¤„ç†æ–¹å¼&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾6ï¼šBPFçš„XDPç¨‹åºçš„4ç§åŒ…å¤„ç†æ–¹å¼&lt;&#x2F;p&gt;
&lt;p&gt;XDPçš„4ç§åŒ…å¤„ç†æ–¹å¼&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;PASS æ”¾è¡Œåˆ°kernel &lt;&#x2F;li&gt;
&lt;li&gt;DROP ä¸¢å¼ƒï¼Œä¸åˆ°kernel&lt;&#x2F;li&gt;
&lt;li&gt;REDIRECT è½¬å‘å…¶ä»–å¤„ç†&lt;&#x2F;li&gt;
&lt;li&gt;TX åŸè·¯è¿”å›(ç”¨äºé˜»æ–­å’Œé‡å®šå‘)&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;xdpde-xie-zai-wang-qia-xing-neng&quot;&gt;XDPçš„å¸è½½ç½‘å¡æ€§èƒ½&lt;&#x2F;h3&gt;
&lt;p&gt;Netronomeæ™ºèƒ½ç½‘å¡æ•°æ®&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;XDP 3ä¸ªhookç‚¹(ç½‘å¡Offload&#x2F;å†…æ ¸å‰Native&#x2F;å†…æ ¸ä¸­Generic)&lt;&#x2F;li&gt;
&lt;li&gt;Offload 1 coreæ¯”Native 8 coreå¿«è¿‘ä¼¼1&#x2F;3å€&lt;&#x2F;li&gt;
&lt;li&gt;Nativeä¸‹æ¯”DPDKç¨æ…¢ï¼Œæ€§èƒ½ç›¸å·®ä¸å¤š Stackoverflow  Redhat&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;09netonome-lb.png&quot; alt=&quot;XDPçš„3ç§æŒ‚è½½æ¨¡å¼çš„æ€§èƒ½&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾7ï¼šXDPçš„3ç§æŒ‚è½½æ¨¡å¼çš„æ€§èƒ½&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;10netonome-layers.png&quot; alt=&quot;XDPåœ¨ç½‘ç»œåè®®æ ˆçš„ä½ç½®&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾8ï¼šXDPåœ¨ç½‘ç»œåè®®æ ˆçš„ä½ç½®&lt;&#x2F;p&gt;
&lt;h3 id=&quot;nacya-ce-ji-lu&quot;&gt;NACå‹æµ‹è®°å½•&lt;&#x2F;h3&gt;
&lt;p&gt;3ç§ç±»å‹çš„ååç‡,NAC WSL2è™šæ‹Ÿæœº&lt;&#x2F;p&gt;
&lt;p&gt;XDP_DROP ç›´æ¥ä¸¢å¼ƒ&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#f9f9f9;color:#111111;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;â¯&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; tcpreplay&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07219;&quot;&gt; -t -i&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; lo t.pcap&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Actual:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 56320 packets (46419288 bytes&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;sent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; in 1.10 seconds&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Rated:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 42062496.6 Bps, 336.49 Mbps, 51033.95 pps&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Flows:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 1091 flows, 988.60 fps, 56290 flow packets, 30 non-flow&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;XDP_TX é˜»æ–­ã€é‡å®šå‘&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#f9f9f9;color:#111111;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Actual:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 56320 packets (46419288 bytes&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;sent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; in 1.30 seconds&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Rated:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 35446666.1 Bps, 283.57 Mbps, 43007.04 pps&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Flows:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 1091 flows, 833.10 fps, 56290 flow packets, 30 non-flow&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;XDP_TX + map_perf é˜»æ–­å¹¶ä¸ŠæŠ¥åº”ç”¨&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#f9f9f9;color:#111111;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Actual:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 56320 packets (46419288 bytes&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;sent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; in 1.49 seconds&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Rated:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 31016641.1 Bps, 248.13 Mbps, 37632.14 pps&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c82728;&quot;&gt;Flows:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4271ae;&quot;&gt; 1091 flows, 728.98 fps, 56290 flow packets, 30 non-flow&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ç«å“ 10ä¸ªåƒå…†ç”µå£,æ¯ç§’äº‹åŠ¡æ•°1000TPSï¼Œæœ€å¤§ååé‡500Mbpsï¼Œæœ€å¤§å¹¶å‘è¿æ¥æ•°:1000(æ¡)&lt;&#x2F;p&gt;
&lt;h3 id=&quot;bpfji-zhu-jie-shao-an-li-fen-xi&quot;&gt;BPFæŠ€æœ¯ä»‹ç» - æ¡ˆä¾‹åˆ†æ&lt;&#x2F;h3&gt;
&lt;p&gt;å®é™…æ¡ˆä¾‹ cloudflare DDOS 
Miraiåƒµå°¸ç½‘ç»œçš„3æ¬¡æ”»å‡»&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;11ddos-miral.png&quot; alt=&quot;DDOSæ—¶ç½‘ç»œæ‰¿è½½çš„æµé‡&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾9ï¼šDDOSæ—¶ç½‘ç»œæ‰¿è½½çš„æµé‡&lt;&#x2F;p&gt;
&lt;p&gt;2020.07ï¼Œ 654Gbpsï¼Œ SYN æ´ªæ°´å’ŒUDP æ´ªæ°´ 
2021.08 ï¼Œ1.2Tbpsï¼Œ SYN æ´ªæ°´å’ŒUDP æ´ªæ°´ï¼Œæœ€å¤§HTTPè¯·æ±‚2500ä¸‡æ¬¡&#x2F;s , 3 ç§’å†…è¢«é˜»æ­¢
2021.11ï¼Œ 2Tbpsï¼Œ 1åˆ†é’Ÿçš„DNS æ”¾å¤§æ”»å‡»å’Œ UDP æ´ªæ°´ï¼Œ1.5 ä¸‡ä¸ªåƒµå°¸ ï¼ˆä¸‹å›¾ï¼‰
è¿‘2Tbps&lt;&#x2F;p&gt;
&lt;p&gt;DDOSç¼“è§£æµç¨‹ 
ç”Ÿæ€é“¾ï¼šå…¨BPFç³»åˆ—äº§å“é›†æˆ&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;12ddos-xdp.png&quot; alt=&quot;ç¼“è§£DDOSæ—¶ä½¿ç”¨XDPçš„å·¥å…·é“¾&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾10ï¼šç¼“è§£DDOSæ—¶ä½¿ç”¨XDPçš„å·¥å…·é“¾&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥æ”¶æ ·æœ¬åˆ†æåˆ°æ”»å‡»æ—¶è‡ªåŠ¨æ¨é€ç¼“è§£ç­–ç•¥&lt;&#x2F;li&gt;
&lt;li&gt;å†åœ¨æ¯å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œæœ¬åœ°ç¼“è§£ç­–ç•¥,&lt;&#x2F;li&gt;
&lt;li&gt;DDosçš„L4Drop (XDP)&lt;&#x2F;li&gt;
&lt;li&gt;LBçš„Unimog     (XDP) &lt;&#x2F;li&gt;
&lt;li&gt;é˜²ç«å¢™çš„Magic firewall (BPF xt_btf)&lt;&#x2F;li&gt;
&lt;li&gt;åˆ†å‘å’Œç›‘è§†&lt;&#x2F;li&gt;
&lt;li&gt;UDPé™é€Ÿ (BPF SO_ATTACH_BPF)&lt;&#x2F;li&gt;
&lt;li&gt;ä¸ŠæŠ¥æŒ‡æ ‡çš„ebpf_exporter&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;13ddos-bpf.png&quot; alt=&quot;ç¼“è§£DDOSæ—¶ä½¿ç”¨XDPçš„åè®®æ‰¾æŠ€æœ¯&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾11ï¼šç¼“è§£DDOSæ—¶ä½¿ç”¨XDPçš„åè®®æ‰¾æŠ€æœ¯&lt;&#x2F;p&gt;
&lt;h3 id=&quot;p0fzhi-wen-ku-shuo-ming-tcp-headerte-zheng&quot;&gt;p0fæŒ‡çº¹åº“è¯´æ˜ TCP headerç‰¹å¾&lt;&#x2F;h3&gt;
&lt;p&gt;DDOSæµé‡æŒ‡çº¹è¯†åˆ« &lt;&#x2F;p&gt;
&lt;p&gt;æŒ‡çº¹ç±»å‹&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#f9f9f9;color:#111111;&quot;&gt;&lt;code&gt;&lt;span&gt;Windows XP: 4:120+8:0:1452:65535,0   :mss,nop,nop,sok   :df,id+:0&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;Windows 7:  4:128:0:*     :8192,8    :mss,nop,ws,nop,sok:df,id+:0&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;Windows 11: 4:128+0:0:1460:mss*44,8  :mss,nop,ws,nop,sok:df,id+:0&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;ubuntu 14:  4:64   :0     :*:mss*10,6:mss,sok,ts,nop,ws :df,id+:0&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;TCPæŒ‡çº¹ åˆ¤æ–­ä¾æ®ï¼ŒLinuxçš„TTLä¸º64ï¼ŒWinæ˜¯128ï¼Œflagsçš„æ•°é‡å’Œä½ç½®ï¼ŒLinuxä¸Winä¸åŒ&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#f9f9f9;color:#111111;&quot;&gt;&lt;code&gt;&lt;span&gt;4: IP version &lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  64: TTL   &lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;     0: IP options length&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;       *: MSS maximum segment size&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;         mss*10,6: TCP window size and scale&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;                  mss,sok,ts,nop,ws: TCP Options(sok:selective ACK permitted)&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;                                 df,id+: quirks(df: don&amp;#39;t fragment)&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;                                        0 TCP Payload Length&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;fu-zai-jun-heng-zhong-de-liu-liang-biao-shi&quot;&gt;è´Ÿè½½å‡è¡¡ä¸­çš„æµé‡æ ‡è¯†&lt;&#x2F;h3&gt;
&lt;p&gt;Facebook katran TCP optionæ·»åŠ è‡ªå®šä¹‰ID&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;14katran.png&quot; alt=&quot;è´Ÿè½½å‡è¡¡æ—¶XDPåœ¨L4å±‚ä¸å…¶ä»–æœåŠ¡é—´çš„å…³ç³»&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾12ï¼šè´Ÿè½½å‡è¡¡æ—¶XDPåœ¨L4å±‚ä¸å…¶ä»–æœåŠ¡é—´çš„å…³ç³»&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å°†server_idåŠ åœ¨TCPå¤´ä¸­å®ç°æ— çŠ¶æ€è·¯ç”±æœºåˆ¶&lt;&#x2F;li&gt;
&lt;li&gt;å¤„ç†TCPå¤´é¢å¤–å¼€é”€(CPU&#x2F;memory)éå¸¸å°&lt;&#x2F;li&gt;
&lt;li&gt;æ ¹æ®server_idä½¿ç”¨Maglev Hashå˜ç§é€‰æ‹©åç«¯&lt;&#x2F;li&gt;
&lt;li&gt;åªé€‚ç”¨äºæ— é˜²ç«å¢™çš„å†…ç½‘&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;æ‹¦æˆªäº‹ä»¶ç‚¹è¯»å†™server_id&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;15katran-serverid.png&quot; alt=&quot;XDPåœ¨L4å±‚è´Ÿè½½å‡è¡¡æ—¶ç”¨åˆ°çš„äº‹ä»¶&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾13ï¼šXDPåœ¨L4å±‚è´Ÿè½½å‡è¡¡æ—¶ç”¨åˆ°çš„äº‹ä»¶&lt;&#x2F;p&gt;
&lt;h3 id=&quot;ke-guan-ce-xing-diao-shi&quot;&gt;å¯è§‚æµ‹æ€§ è°ƒè¯•&lt;&#x2F;h3&gt;
&lt;p&gt;cilium pwru (packet, where are you?)&lt;&#x2F;p&gt;
&lt;p&gt;è·Ÿè¸ªå†…æ ¸ä¸­çš„ç½‘ç»œåŒ…çš„APIè°ƒç”¨&lt;&#x2F;p&gt;
&lt;h3 id=&quot;bpfji-zhu-jie-shao-ji-zhu-fen-xi&quot;&gt;BPFæŠ€æœ¯ä»‹ç» - æŠ€æœ¯åˆ†æ&lt;&#x2F;h3&gt;
&lt;p&gt;BPFå¼€å‘è¿è¡Œæœºåˆ¶&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;16bpf-flow.png&quot; alt=&quot;BPFç”Ÿå‘½å‘¨æœŸæµç¨‹&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾14ï¼šBPFç”Ÿå‘½å‘¨æœŸæµç¨‹(ç½‘ç»œçš„XDPå’ŒTC)&lt;&#x2F;p&gt;
&lt;p&gt;1.ç¼–å†™ã€ç¼–è¯‘
2.æ ¡éªŒ
3.BPFå­—èŠ‚ç åˆ°æœºå™¨ç 
4.æŒ‚è½½æ‰§è¡Œ
6.ä¸ç³»ç»Ÿé€šä¿¡
5.XDPçš„DROP&#x2F;PASS&#x2F;TX&#x2F;REDIRECT&lt;&#x2F;p&gt;
&lt;h3 id=&quot;cbpfxu-ni-ji-yuan-li&quot;&gt;cBPFè™šæ‹ŸæœºåŸç†&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;17bpf-model1.png&quot; alt=&quot;ä»£ç åœ¨ç¼–è¯‘å™¨çš„åˆ†è§£&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾15ï¼šä»£ç åœ¨ç¼–è¯‘å™¨çš„åˆ†è§£&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;18bpf-model2.png&quot; alt=&quot;BPFè½¬æ¢æˆDAG&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾16ï¼šBPFè½¬æ¢æˆDAG&lt;&#x2F;p&gt;
&lt;p&gt;BPF åŸºäºå¯„å­˜å™¨è™šæ‹Ÿæœºï¼Œç¨‹åºæœ€ç»ˆè½¬æ¢æˆä¸€ä¸ªDAGï¼Œå¹¶ç”±å†…æ ¸æ¥æ‰§è¡Œ
è¿‡æ»¤å™¨è¡¨è¾¾å¼åœ¨ä¸¤ç§æ¨¡å¼ä¸‹çš„ç¼–è¯‘åˆ†è§£ï¼Œè§ä¸‹å›¾
æ¨¡å‹1: åˆ¶çº¦æ€§èƒ½æœ€å¤§çš„é—®é¢˜ï¼Œæœ‰é‡å¤è®¡ç®—
æ¨¡å‹2: ç­‰ä»·äºæ¨¡å‹1ï¼Œåªéœ€6æ¬¡å¸ƒå°”è¿ç®—ï¼Œéå†å®Œæ•´æ£µæ ‘
æ¨¡å‹2 eBPF
æ¨¡å‹1 cBPF&lt;&#x2F;p&gt;
&lt;h3 id=&quot;cbpfxu-ni-ji-zhi-xing-liu-cheng&quot;&gt;cBPFè™šæ‹Ÿæœºæ‰§è¡Œæµç¨‹&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;19bpf-asm1.png&quot; alt=&quot;BPFå†…éƒ¨æ‰§è¡Œæµç¨‹&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾17ï¼šBPFå†…éƒ¨æ‰§è¡Œæµç¨‹&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;..&#x2F;images&#x2F;bpf-xdp&#x2F;20bpf-asm2.png&quot; alt=&quot;BPFæŒ‡ä»¤ç è§£é‡Š&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;å›¾18ï¼šBPFæŒ‡ä»¤ç è§£é‡Š&lt;&#x2F;p&gt;
&lt;p&gt;$ tcpdump tcp port 443 -d&lt;&#x2F;p&gt;
&lt;h3 id=&quot;bpfxian-you-wen-ti&quot;&gt;BPFç°æœ‰é—®é¢˜&lt;&#x2F;h3&gt;
&lt;p&gt;å†…æ ¸ç‰ˆæœ¬å’Œå®‰å…¨&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;å†…æ ¸ç‰ˆæœ¬æ”¯æŒ Linux &amp;gt; V4.18&lt;&#x2F;li&gt;
&lt;li&gt;XDPåŠå…¶MAPçš„æ”¯æŒ&lt;&#x2F;li&gt;
&lt;li&gt;BTFè·¨ä¸åŒç‰ˆæœ¬å†…æ ¸è¿è¡Œ&lt;&#x2F;li&gt;
&lt;li&gt;å®‰å…¨ ææƒæ¼æ´ Linux V5.7~V5.8&lt;&#x2F;li&gt;
&lt;li&gt;CVE-2020-27194ï¼šVerifyæ—¶è¶Šç•Œè¯»å†™é€ æˆ&lt;&#x2F;li&gt;
&lt;li&gt;CVE-2020-8835ï¼šVerifyæ—¶å¸¸æ•°å˜é‡å–å€¼èŒƒå›´çš„é€»è¾‘é”™è¯¯&lt;&#x2F;li&gt;
&lt;li&gt;CVE-2020-27194ï¼šVerifyæ—¶å¯„å­˜å™¨è¾¹ç•Œè·Ÿè¸ª&lt;&#x2F;li&gt;
&lt;li&gt;å®¹å™¨é€ƒé€¸: ç¼–å†™Rootkitï¼Œä¿®æ”¹ç”¨æˆ·ç©ºé—´ï¼Œhookç½‘ç»œæ•°æ®&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
</feed>
